<?xml version="1.0" encoding="utf-8" ?>
<Patch>
<!-- REBALANCE -->
<!-- allowed items -->
    <!-- cargo container -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageCargoContainer"]/building/fixedStorageSettings/filter</xpath>
        <value>
            <filter>
                <disallowNotEverStorable>true</disallowNotEverStorable>
                <categories>
                    <li>Root</li>
                </categories>
                <disallowedCategories>
                    <li>Chunks</li>
                    <li>Corpses</li>
                </disallowedCategories>
            </filter>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[defName="BasicStorageCargoContainer"]/building</xpath>
        <value>
            <defaultStorageSettings>
                <priority>Preferred</priority>
                <filter>
                    <disallowNotEverStorable>true</disallowNotEverStorable>
                    <categories>
                        <li>Root</li>
                    </categories>
                    <disallowedCategories>
                        <li>Chunks</li>
                        <li>Corpses</li>
                    </disallowedCategories>
                </filter>
            </defaultStorageSettings>
        </value>
    </Operation>
    <!-- crates -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageWoodenCrate" or defName="BasicStorageMediumCrate" or defName="BasicStorageLargeCrate" or defName="BasicStorageMetalCrate"]/building/fixedStorageSettings/filter</xpath>
        <value>
            <filter>
                <disallowNotEverStorable>true</disallowNotEverStorable>
                <categories>
                    <li>Manufactured</li>
                    <li>ResourcesRaw</li>
                </categories>
            </filter>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[defName="BasicStorageWoodenCrate" or defName="BasicStorageMediumCrate" or defName="BasicStorageLargeCrate" or defName="BasicStorageMetalCrate"]/building</xpath>
        <value>
            <defaultStorageSettings>
                <priority>Preferred</priority>
                <filter>
                    <disallowNotEverStorable>true</disallowNotEverStorable>
                    <categories>
                        <li>Manufactured</li>
                        <li>ResourcesRaw</li>
                    </categories>
                </filter>
            </defaultStorageSettings>
        </value>
    </Operation>
    <!-- pallets -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStoragePalletSmall" or defName="BasicStoragePalletLarge"]/building/fixedStorageSettings/filter</xpath>
        <value>
            <filter>
                <disallowNotEverStorable>true</disallowNotEverStorable>
                <categories>
                    <li>ResourcesRaw</li>
                    <li>Chunks</li>
                    <li>Buildings</li>
                    <li>Plants</li>
                </categories>
            </filter>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[defName="BasicStoragePalletSmall" or defName="BasicStoragePalletLarge"]/building</xpath>
        <value>
            <defaultStorageSettings>
                <priority>Preferred</priority>
                <filter>
                    <categories>
                        <li>ResourcesRaw</li>
                        <li>Chunks</li>
                        <li>Buildings</li>
                        <li>Plants</li>
                    </categories>
                </filter>
            </defaultStorageSettings>
        </value>
    </Operation>
    <!-- dumpster -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageIndustrialContainer"]/building/fixedStorageSettings/filter</xpath>
        <value>
            <filter>
                <disallowNotEverStorable>true</disallowNotEverStorable>
                <specialFiltersToAllow>
                    <li MayRequire="ludeon.rimworld.ideology">AllowVegetarian</li>
                </specialFiltersToAllow>
                <categories>
                    <li>Chunks</li>
                    <li>Corpses</li>
                    <li MayRequire="dubwise.dubsbadhygiene">Waste</li>
                    <li MayRequire="vanillaexpanded.recycling">VRecyclingE_SpecializedPacks</li>
                </categories>
                <thingDefs>  
                    <li MayRequire="ludeon.rimworld.biotech">Wastepack</li>
                </thingDefs>
            </filter>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[defName="BasicStorageIndustrialContainer"]/building</xpath>
        <value>
            <defaultStorageSettings>
                <filter>
                    <specialFiltersToAllow>
                        <li MayRequire="ludeon.rimworld.ideology">AllowVegetarian</li>
                    </specialFiltersToAllow>
                    <categories>
                        <li>Chunks</li>
                        <li>Corpses</li>
                        <li MayRequire="dubwise.dubsbadhygiene">Waste</li>
                        <li MayRequire="vanillaexpanded.recycling">VRecyclingE_SpecializedPacks</li>
                    </categories>
                    <thingDefs>  
                        <li MayRequire="ludeon.rimworld.biotech">Wastepack</li>
                    </thingDefs>
                </filter>
            </defaultStorageSettings>
        </value>
    </Operation>
    <!-- cask -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageCask"]/building/fixedStorageSettings/filter</xpath>
        <value>
            <filter>
                <disallowNotEverStorable>true</disallowNotEverStorable>
                <specialFiltersToAllow>
                    <li MayRequire="ludeon.rimworld.ideology">AllowVegetarian</li>
                </specialFiltersToAllow>
                <disallowNotEverStorable>true</disallowNotEverStorable>
                <categories>
                    <li MayRequire="vanillaexpanded.vbrewe">VBE_DrinksSimpleSpirits</li>
                    <li MayRequire="vanillaexpanded.vbrewe">VBE_DrinksLuxurySpirits</li>
                </categories>
                <thingDefs>
                    <li>Beer</li>
                </thingDefs>
            </filter>
        </value>
    </Operation>
    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ThingDef[defName="BasicStorageCask"]/building</xpath>
        <value>
            <defaultStorageSettings>
                <filter>
                    <specialFiltersToAllow>
                        <li MayRequire="ludeon.rimworld.ideology">AllowVegetarian</li>
                    </specialFiltersToAllow>
                    <disallowNotEverStorable>true</disallowNotEverStorable>
                    <categories>
                        <li MayRequire="vanillaexpanded.vbrewe">VBE_DrinksSimpleSpirits</li>
                        <li MayRequire="vanillaexpanded.vbrewe">VBE_DrinksLuxurySpirits</li>
                    </categories>
                    <thingDefs>
                        <li>Beer</li>
                    </thingDefs>
                </filter>
            </defaultStorageSettings>
        </value>
    </Operation>
    
<!-- item specific -->
    <!-- Sack -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageSack"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>3</maxItemsInCell>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/AdaptiveStorage.GraphicsDef[@ParentName="BasicStorageSackBase"]/graphics/li[minimumStackCount="5"]/minimumStackCount</xpath>
        <value>
            <minimumStackCount>3</minimumStackCount>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageSack"]/costStuffCount</xpath>
        <value>
            <costStuffCount>10</costStuffCount>
        </value>
    </Operation>
    <!-- Large Bundle -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageLargeBundle"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>4</maxItemsInCell>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageLargeBundle"]/costStuffCount</xpath>
        <value>
            <costStuffCount>40</costStuffCount>
        </value>
    </Operation>
    <!-- Cargo Container -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageCargoContainer"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>7</maxItemsInCell>
        </value>
    </Operation>
    <!-- Cask -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageCask"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>6</maxItemsInCell>
        </value>
    </Operation>
    <!-- Small Crate -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageWoodenCrate"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>4</maxItemsInCell>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/AdaptiveStorage.GraphicsDef[@ParentName="BasicStorageWoodenCrateBase"]/graphics/li[minimumStackCount="4"]/minimumStackCount</xpath>
        <value>
            <minimumStackCount>3</minimumStackCount>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageWoodenCrate"]/costStuffCount</xpath>
        <value>
            <costStuffCount>15</costStuffCount>
        </value>
    </Operation>
    <!-- Medium Crate -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageMediumCrate"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>4</maxItemsInCell>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageMediumCrate"]/costStuffCount</xpath>
        <value>
            <costStuffCount>20</costStuffCount>
        </value>
    </Operation>
    <!-- Large Crate -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageLargeCrate"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>4</maxItemsInCell>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageLargeCrate"]/costStuffCount</xpath>
        <value>
            <costStuffCount>50</costStuffCount>
        </value>
    </Operation>
    <!-- Food Barrel -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageFoodBarrel"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>6</maxItemsInCell>
        </value>
    </Operation>
    <!-- Pantry Shelf -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageFoodCupboard"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>6</maxItemsInCell>
        </value>
    </Operation>
    <!-- Fuel Tank -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageFuelTank"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>10</maxItemsInCell>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageFuelTank"]/costStuffCount</xpath>
        <value>
            <costStuffCount>250</costStuffCount>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageFuelTank"]/costStuffCount</xpath>
        <value>
            <costStuffCount>150</costStuffCount>
        </value>
    </Operation>
    <!-- Industrial Dumpster -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageIndustrialContainer"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>8</maxItemsInCell>
        </value>
    </Operation>
    <!-- Meal Cupbaord -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageMealStorage"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>6</maxItemsInCell>
        </value>
    </Operation>
    <!-- Meat Hook -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageMeatHook"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>6</maxItemsInCell>
        </value>
    </Operation>
    <!-- Metal Crate -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageMetalCrate"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>8</maxItemsInCell>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/AdaptiveStorage.GraphicsDef[@ParentName="BasicStorageMetalCrateBase"]/graphics/li[minimumStackCount="5"]/minimumStackCount
</xpath>
        <value>
            <minimumStackCount>6</minimumStackCount>
        </value>
    </Operation>
    <!-- Small Pallet -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStoragePalletSmall"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>4</maxItemsInCell>
        </value>
    </Operation>
    <!--
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStoragePalletSmall"]/minimumStackCount</xpath>
        <value>
            <minimumStackCount>3</minimumStackCount>
        </value>
    </Operation>
    -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStoragePalletSmall"]/costStuffCount</xpath>
        <value>
            <costStuffCount>10</costStuffCount>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/AdaptiveStorage.GraphicsDef[@ParentName="BasicStoragePallet1x1_Base"]/graphics/li[minimumStackCount="5"]/minimumStackCount</xpath>
        <value>
            <minimumStackCount>4</minimumStackCount>
        </value>
    </Operation>
    <!-- Large Pallet -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStoragePalletLarge"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>4</maxItemsInCell>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStoragePalletLarge"]/costStuffCount</xpath>
        <value>
            <costStuffCount>40</costStuffCount>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/AdaptiveStorage.GraphicsDef[@ParentName="BasicStoragePallet2x2_Base"]/graphics/li[minimumStackCount="5"]/minimumStackCount</xpath>
        <value>
            <minimumStackCount>4</minimumStackCount>
        </value>
    </Operation>
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/AdaptiveStorage.GraphicsDef[@ParentName="BasicStoragePallet2x2_Base"]/graphics/li[minimumStackCount="10"]/minimumStackCount</xpath>
        <value>
            <minimumStackCount>8</minimumStackCount>
        </value>
    </Operation>
    <!-- Stone Pot -->
    <!--
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageStonePot"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>3</maxItemsInCell>
        </value>
    </Operation>
    -->
    <!-- Weapon Rack -->
    <!--
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageWeaponRack"]/building/maxItemsInCell</xpath>
        <value>
            <maxItemsInCell>6</maxItemsInCell>
        </value>
    </Operation>
    -->
    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ThingDef[defName="BasicStorageWeaponRack"]/costStuffCount</xpath>
        <value>
            <costStuffCount>50</costStuffCount>
        </value>
    </Operation>

<!-- FERNY ORGANIZE -->
    <Operation Class="PatchOperationConditional">
        <xpath>Defs/DesignationCategoryDef[defName="Ferny_Storage"]</xpath>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="BasicStorageLargeBundle" or defName="BasicStoragePalletSmall" or defName="BasicStoragePalletLarge" or defName="BasicStorageStonePot" or defName="BasicStorageWoodenCrate" or defName="BasicStorageMediumCrate" or defName="BasicStorageLargeCrate" or defName="BasicStorageMetalCrate"]</xpath>
                    <value>
                        <designationCategory>Ferny_GeneralStorage</designationCategory>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="BasicStorageSack" or defName="BasicStorageCask" or defName="BasicStorageFoodBarrel" or defName="BasicStorageFoodCupboard" or defName="BasicStorageMealStorage" or defName="BasicStorageMeatHook"]</xpath>
                    <value>
                        <designationCategory>Ferny_FoodStorage</designationCategory>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="BasicStorageCargoContainer" or defName="BasicStorageFuelTank" or defName="BasicStorageIndustrialContainer"]</xpath>
                    <value>
                        <designationCategory>Ferny_ResourcesStorage</designationCategory>
                    </value>
                </li>
                <li Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="BasicStorageWeaponRack"]</xpath>
                    <value>
                        <designationCategory>Ferny_GearStorage</designationCategory>
                    </value>
                </li>
            </operations>
        </match>
        <nomatch Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="BasicStorageSack" or defName="BasicStorageCargoContainer" or defName="BasicStorageCask" or defName="BasicStorageFoodBarrel" or defName="BasicStorageFoodCupboard" or defName="BasicStorageFuelTank" or defName="BasicStorageIndustrialContainer" or defName="BasicStorageMealStorage" or defName="BasicStoragePalletSmall" or defName="BasicStoragePalletLarge" or defName="BasicStorageLargeBundle" or defName="BasicStorageStonePot" or defName="BasicStorageWoodenCrate" or defName="BasicStorageMediumCrate" or defName="BasicStorageLargeCrate" or defName="BasicStorageMetalCrate" or defName="BasicStorageMeatHook" or defName="BasicStorageWeaponRack"]</xpath>
            <value>
                <designationCategory>ASFstorage</designationCategory>
            </value>
        </nomatch>
    </Operation>

<!-- REMOVE DUPLICATES -->
    <!-- Reels -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Reel's Expanded Storage</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="BasicStorageWoodenCrate" or defName="BasicStorageMediumCrate" or defName="BasicStorageLargeCrate" or defName="BasicStorageMetalCrate" or defName="BasicStorageMeatHook"]/designationCategory</xpath>
                    <value>
                        <designationCategory></designationCategory>
                    </value>
                </li>
                <li Class="PatchOperationAdd" MayRequire="oskarpotocki.vanillafactionsexpanded.core">
                    <xpath>Defs/VEF.Buildings.HiddenDesignatorsDef[defName="StorageBalancePatches_HiddenDesignators"]/hiddenDesignators</xpath>
                    <value>
                        <li>BasicStorageWoodenCrate</li>
                        <li>BasicStorageMediumCrate</li>
                        <li>BasicStorageLargeCrate</li>
                        <li>BasicStorageMetalCrate</li>
                        <li>BasicStorageMeatHook</li>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
    <!-- Neat -->
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>[sbz] Neat Storage</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="BasicStorageMeatHook" or defName="BasicStorageWeaponRack"]/designationCategory</xpath>
                    <value>
                        <designationCategory></designationCategory>
                    </value>
                </li>
                <li Class="PatchOperationAdd" MayRequire="oskarpotocki.vanillafactionsexpanded.core">
                    <xpath>Defs/VEF.Buildings.HiddenDesignatorsDef[defName="StorageBalancePatches_HiddenDesignators"]/hiddenDesignators</xpath>
                    <value>
                        <li>BasicStorageMeatHook</li>
                        <li>BasicStorageWeaponRack</li>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Adaptive Ideology Storage</li>
        </mods>
        <match Class="PatchOperationSequence">
            <operations>
                <li Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="BasicStorageFuelTank"]/designationCategory</xpath>
                    <value>
                        <designationCategory></designationCategory>
                    </value>
                </li>
                <li Class="PatchOperationAdd" MayRequire="oskarpotocki.vanillafactionsexpanded.core">
                    <xpath>Defs/VEF.Buildings.HiddenDesignatorsDef[defName="StorageBalancePatches_HiddenDesignators"]/hiddenDesignators</xpath>
                    <value>
                        <li>BasicStorageFuelTank</li>
                    </value>
                </li>
            </operations>
        </match>
    </Operation>
</Patch>